<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Forgot Password</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"/>
  <script defer src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
    <main class="fp-card-container">
        <form id="forgotPasswordForm" class="fp-form-card">
            <h2>Forgot Password</h2>
            <p>Enter your email address. We'll send you a 4-digits OTP.</p>
            <div class="fp-input-group">
                <label>Email</label>
                <div class="fp-input-wrapper">
                    <span class="fp-icon">ðŸ“§</span>
                    <input type="email" name="email" placeholder="Email" required />
                </div>
            </div>
            <div class="actions">
                <button type="submit">Send OTP</button>
            </div>
            <a href="/" class="back-link">ðŸ”™</a>
        </form>
    </main>

    <script>
        document.getElementById("forgotPasswordForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        const email = this.email.value.trim();
        if (!email) {
            Toastify({ text: "Please enter your email.", duration: 3000, gravity:'top', position:'center', backgroundColor:'#e74c3c' }).showToast();
            return;
        }

        // Send OTP
        const res = await fetch('/send-otp', {
            method: 'POST',
            headers: { 'x-requested-with': 'fetch' },
            body: new FormData(this)
        }).then(r => r.json()).catch(() => ({ ok:false }));

        if (res.ok) {
            Toastify({ text: "OTP sentâ€”check your email.", duration: 3000, gravity:'top', position:'center', backgroundColor:'#2ecc71' }).showToast();
            // Redirect with email query
            setTimeout(() => {
            window.location.href = `/verify-otp.html?email=${encodeURIComponent(email)}`;
            }, 1000);
        } else {
            Toastify({ text: "Failed to send OTP. Try again.", duration: 3000, gravity:'top', position:'center', backgroundColor:'#e74c3c' }).showToast();
        }
        });
    </script>
</body>