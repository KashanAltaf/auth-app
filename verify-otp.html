<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Enter OTP</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"/>
  <script defer src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
    <main class="otp-card-container">
        <form id="otpForm" class="otp-form-card">
            <h2>Enter OTP</h2>
            <p>We've sent a 4-digit code to<br><strong id="userEmail"></strong></p>
            
            <div id="otp-input-group" class="otp-input-group">
                <p class="otp-input-label" id="otp-label">Verification Code</p>
                <div class="otp-boxes" role="group" aria-labelledby="otp-label">
                    <input type="text" class="otp-box" inputmode="numeric" pattern="[0-9]" maxlength="1" aria-label="First digit" />
                    <input type="text" class="otp-box" inputmode="numeric" pattern="[0-9]" maxlength="1" aria-label="Second digit" />
                    <input type="text" class="otp-box" inputmode="numeric" pattern="[0-9]" maxlength="1" aria-label="Third digit" />
                    <input type="text" class="otp-box" inputmode="numeric" pattern="[0-9]" maxlength="1" aria-label="Fourth digit" />
                </div>
            </div>
            
            <button type="submit" id="submitButton">Verify</button>
            
            <div class="otp-resend-container">
                Didn't receive code? 
                <a href="#" id="resendLink" class="otp-resend-link disabled" aria-disabled="true">Resend</a>
                <span id="timer" class="timer"></span>
            </div>
            
            <a href="/forgot-password.html" class="back-link" aria-label="Back to previous page">
                <span aria-hidden="true">ðŸ”™</span> Back
            </a>
        </form>
    </main>


    <script>
        const params = new URLSearchParams(window.location.search);
        const userEmail = params.get("email") || "";
        document.getElementById("userEmail").textContent = userEmail;

        const boxes = [...document.querySelectorAll(".otp-boxes input")];
        boxes.forEach((box, i) => {
            box.addEventListener("input", e => {
                e.target.value = e.target.value.replace(/[^0-9]/g, "");
                if (e.target.value && i < boxes.length - 1) {
                  boxes[i + 1].focus();
                }
            });
            box.addEventListener("keydown", e => {
                if (e.key === "Backspace" && !box.value && i > 0) {
                    boxes[i - 1].focus();
                }
            });
        });


        document.getElementById("otpForm").addEventListener("submit", e => {
            e.preventDefault();
            const otp = boxes.map(b => b.value).join("");
            if(otp.length != 4){
                Toastify({
                    text: "Please enter al 4 digits.",
                    duration: 3000,
                    gravity: 'top',
                    position: 'center',
                    backgroundColor: '#e74c3c'
                }).showToast();
                return;
            }
            window.location.href = `/reset-password.html?email=${encodeURIComponent(userEmail)}`;
        });
    </script>
</body>